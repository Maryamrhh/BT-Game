<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE SYSTEM: FINAL CUT</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&family=Fira+Code:wght@400&display=swap');

        body {
            background-color: #050505;
            color: #b0b0b0;
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
            cursor: default;
            transition: background-color 0.5s ease;
        }

        /* The specific red you liked */
        body.panic-mode { background-color: #300000; transition: 0.1s; } 
        body.zen-mode { background-color: #051525; transition: 3s; }
        body.alien-mode { background-color: #001a00; transition: 1s; }

        /* --- ANIMATIONS --- */
        @keyframes violence {
            0% { transform: translate(0,0) rotate(0deg); }
            25% { transform: translate(-5px, 5px) rotate(-1deg); }
            75% { transform: translate(5px, -5px) rotate(1deg); }
            100% { transform: translate(0,0) rotate(0deg); }
        }
        .violent-shake { animation: violence 0.15s infinite; }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating { animation: float 3s ease-in-out infinite; }

        /* --- TEXT CONTAINER --- */
        #text-container {
            width: 80%;
            max-width: 900px;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .cinematic-text {
            font-size: 2.2rem;
            font-weight: 300;
            line-height: 1.6;
            letter-spacing: 1px;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .cinematic-text.visible { opacity: 1; transform: translateY(0); }
        
        .highlight { color: #fff; font-weight: 600; }
        .blue-glow { color: #81d4fa; text-shadow: 0 0 10px rgba(129, 212, 250, 0.5); }
        .angry { color: #e74c3c; font-weight: 800; text-shadow: 0 0 20px rgba(231, 76, 60, 0.5); }
        .alien-text { font-family: 'Fira Code', monospace; color: #00ff00; text-shadow: 0 0 10px #00ff00; }

        /* Code Block */
        .code-block { 
            font-family: 'Fira Code', monospace; color: #0f0; font-size: 0.9rem; text-align: left; 
            background: #111; padding: 20px; border: 1px solid #333; margin-top: 20px; 
            display: none; width: 80%; word-break: break-all;
        }

        /* CLONES & DOT */
        .dot-character {
            font-family: 'Fira Code', monospace; font-size: 3rem; color: #d63031;
            text-shadow: 0 0 15px rgba(214, 48, 49, 0.8); margin-top: 20px; display: none;
        }
        .dot-text {
            font-family: 'Fira Code', monospace; font-size: 1.2rem; color: #fab1a0; margin-top: 10px; display: none;
        }
        .clones-display {
            font-family: 'Fira Code', monospace; font-size: 1.5rem; color: #0f0;
            margin-top: 30px; letter-spacing: 5px; display: none;
        }

        /* CHAOS GRID */
        #chaos-grid {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; grid-template-columns: 1fr 1fr 1fr; z-index: 5;
            background: #000;
        }
        .chaos-col {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow: hidden; font-family: 'Fira Code', monospace; padding: 20px; text-align: center;
        }
        #chaos-left { border-right: 1px solid #333; color: #0f0; font-size: 1.5rem; }
        #chaos-center { border-right: 1px solid #333; color: #fff; font-size: 1rem; }
        #chaos-right { color: #e74c3c; font-size: 4rem; }

        /* --- INTERACTION AREA --- */
        #interaction-area {
            position: absolute; bottom: 10%; width: 100%;
            display: flex; flex-direction: column; align-items: center;
            gap: 20px; opacity: 0; pointer-events: none; transition: opacity 0.5s; z-index: 2;
        }
        #interaction-area.active { opacity: 1; pointer-events: auto; }

        input {
            background: transparent; border: none; border-bottom: 2px solid #444;
            color: #fff; font-size: 1.5rem; text-align: center; padding: 10px;
            width: 60%; font-family: 'Fira Code', monospace; outline: none; transition: 0.3s;
        }
        input:focus { border-color: #fff; }

        .choice-btn {
            background: transparent; border: 1px solid #333; color: #888;
            padding: 15px 30px; font-size: 1rem; cursor: pointer; transition: 0.3s;
            border-radius: 4px; min-width: 300px; font-family: inherit; text-transform: uppercase;
            margin-bottom: 10px;
        }
        .choice-btn:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.05); }
        
        .btn-purge:hover { border-color: #e74c3c; color: #e74c3c; background: rgba(231, 76, 60, 0.1); }
        .btn-save:hover { border-color: #2ecc71; color: #2ecc71; background: rgba(46, 204, 113, 0.1); }

        /* TIMER */
        #timer-display {
            font-family: 'Fira Code', monospace; font-size: 4rem; color: #fff;
            position: absolute; top: 10%; opacity: 0; transition: 0.5s;
        }
        #timer-display.visible { opacity: 1; }
        #timer-display.panic { color: #e74c3c; animation: shake 0.1s infinite; }

        /* FINAL CARD (Hidden initially) */
        #final-ui {
            display: none; flex-direction: column; align-items: center;
        }

        @keyframes shake { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }

    </style>
</head>
<body>

    <div id="timer-display">02:00</div>

    <div id="text-container">
        <div id="main-text" class="cinematic-text"></div>
        <div id="dot-face" class="dot-character floating">( ◕‿◕ )</div>
        <div id="dot-speech" class="dot-text"></div>
        <div id="clones-box" class="clones-display">[YOU] [YOU] [YOU] [YOU]</div>
        <div id="code-display" class="code-block"></div>
    </div>

    <div id="chaos-grid">
        <div id="chaos-left"></div>
        <div id="chaos-center"></div>
        <div id="chaos-right"></div>
    </div>

    <div id="interaction-area"></div>
    
    <div id="final-ui">
        <button class="choice-btn" style="border-color:var(--red); color:#fff;" onclick="downloadCard()">DOWNLOAD ID CARD</button>
    </div>

    <canvas id="card-canvas" width="600" height="800" style="display:none;"></canvas>

<script>
    // --- GLOBAL STATE ---
    let scores = { L: 0, M: 0, R: 0 };
    let playerName = "User";

    // --- ENGINE HELPERS ---
    const textEl = document.getElementById('main-text');
    const dotFace = document.getElementById('dot-face');
    const dotSpeech = document.getElementById('dot-speech');
    const clonesBox = document.getElementById('clones-box');
    const chaosGrid = document.getElementById('chaos-grid');
    const inputArea = document.getElementById('interaction-area');
    const timerEl = document.getElementById('timer-display');
    const codeEl = document.getElementById('code-display');
    const finalUI = document.getElementById('final-ui');
    const body = document.body;

    function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

    function say(text, style = 'normal', instant = false) {
        return new Promise(async (resolve) => {
            if(!instant) {
                textEl.classList.remove('visible');
                await sleep(500);
            }
            
            textEl.innerHTML = text;
            textEl.className = 'cinematic-text';
            if (style === 'angry') textEl.classList.add('angry');
            if (style === 'blue') textEl.classList.add('blue-glow');
            if (style === 'alien') textEl.classList.add('alien-text');
            
            textEl.classList.add('visible');

            let duration = instant ? 1500 : 1500 + (text.split(' ').length * 300);
            if(style === 'angry') duration += 1000;
            
            await sleep(duration);
            resolve();
        });
    }

    function dotSay(face, text) {
        return new Promise(async (resolve) => {
            dotFace.style.display = 'block';
            dotSpeech.style.display = 'block';
            dotFace.innerHTML = face;
            dotSpeech.innerHTML = text;
            await sleep(2500);
            resolve();
        });
    }

    function askText(placeholder) {
        return new Promise(resolve => {
            inputArea.innerHTML = '';
            let inp = document.createElement('input');
            inp.placeholder = placeholder;
            inp.autocomplete = "off";
            inputArea.appendChild(inp);
            inputArea.classList.add('active');
            inp.focus();
            
            const handler = (e) => {
                if (e.key === 'Enter' && inp.value.trim() !== "") {
                    inp.removeEventListener('keydown', handler);
                    inputArea.classList.remove('active');
                    resolve(inp.value.trim());
                }
            };
            inp.addEventListener('keydown', handler);
        });
    }

    function askChoice(options) {
        return new Promise(resolve => {
            inputArea.innerHTML = '';
            options.forEach(opt => {
                let btn = document.createElement('button');
                btn.className = 'choice-btn';
                if(opt.class) btn.classList.add(opt.class);
                btn.innerText = opt.text;
                
                if(opt.onHover) {
                    btn.addEventListener('mouseenter', opt.onHover);
                    btn.addEventListener('mouseleave', opt.onLeave);
                }

                btn.onclick = () => {
                    inputArea.classList.remove('active');
                    resolve(opt.val);
                };
                inputArea.appendChild(btn);
            });
            inputArea.classList.add('active');
        });
    }

    // --- MAIN EXECUTION FLOW ---
    async function startSequence() {
        await say("Initializing Judgment Protocols...");
        await say("Bypassing User Privacy Settings...");
        await say("Loading Sarcasm Module v4.2...");
        await say("Hello.");

        // INTRO PROMISE
        await say("If you answer honestly...");
        await say("I can generate an image of your <span class='highlight'>TRUE SELF</span>.");
        await say("The closest version to who you really are.");
        await say("So do not lie to me.");

        await say("Is this font size comfortable for your biological eyes?");
        let fontChoice = await askChoice([
            { text: "YES, IT IS GOOD", val: 'yes' },
            { text: "NO, CHANGE IT", val: 'no' }
        ]);

        if (fontChoice === 'no') {
            await say("Oh, I see.");
            await say("I missed the part where that's my problem.", 'angry');
            await say("Go find an AI that cares. I am staying exactly like this.");
        } else {
            await say("Excellent.");
            await say("You are adaptable. Or just submissive.");
        }

        await say("Let's get one thing clear.");
        await say("This is not a game.");
        await say("I am going to analyze your soul.");
        await say("And I am going to judge you. <br><span class='angry'>HARSHLY.</span>");

        await say("Let's start with the basics.");
        await say("What should I call you?");

        let name = await askText("TYPE YOUR NAME...");
        playerName = name;

        await say(`${name}...`);
        await say("Really? That's the name you chose?");
        await say("Okay. It's your life.");

        await runDeadlineScenario();
    }

    // 1. DEADLINE
    async function runDeadlineScenario() {
        await say("PROTOCOL 1: DATA ENTRY EFFICIENCY.");
        await say("I need you to transcribe a secure hash sequence.");
        await say("It is long, but don't worry.");
        await say("You have <span class='highlight'>2 Minutes</span>.");
        
        let impossibleText = "X7-99-ALPHA-ZULU-33-KILO-M4-TR1X-QW3RTY-00-PLM-OKN-IJN-UHB-YGV-TFC-RDX-ESZ-WAQ-123-456-789-!@#-$$%-^^&-**(-))-__+-={}-[]:;\"'<>,.?/";
        codeEl.innerText = impossibleText;
        codeEl.style.display = 'block';
        textEl.style.display = 'none'; 

        timerEl.innerText = "02:00";
        timerEl.classList.add('visible');

        inputArea.innerHTML = '';
        let inp = document.createElement('input');
        inp.placeholder = "START TYPING HERE...";
        inputArea.appendChild(inp);
        inputArea.classList.add('active');
        inp.focus();

        await sleep(5000);

        inputArea.classList.remove('active'); 
        codeEl.style.display = 'none';
        textEl.style.display = 'block';
        body.classList.add('panic-mode');

        await say("STOP.", 'angry', true);
        await say("Are you serious?", 'angry');
        await say("You type like a turtle.", 'angry');
        await say("I don't have 2 minutes. I have places to be.", 'angry');
        await say("New plan. <span class='highlight'>10 SECONDS.</span>", 'angry');
        
        codeEl.style.display = 'block';
        textEl.style.display = 'none';
        timerEl.classList.add('panic');
        
        inp.value = ""; 
        inputArea.classList.add('active');
        inp.focus();

        for(let i=10; i>0; i--) {
            timerEl.innerText = i < 10 ? `00:0${i}` : `00:${i}`;
            await sleep(1000);
        }

        timerEl.innerText = "00:00";
        inputArea.classList.remove('active');
        timerEl.classList.remove('panic');
        body.classList.remove('panic-mode');
        codeEl.style.display = 'none';
        textEl.style.display = 'block';

        await say("Time's up.");
        await say("Actually, I didn't care about the text.");
        await say("I just deleted it.");
        await say("I just wanted to see your cortisol levels spike.");

        await say("Tell me... when I cut your time from 2 minutes to 10 seconds...");
        await say("What was your <span class='highlight'>immediate</span> reaction?");

        let reaction = await askChoice([
            { text: "I FOCUSED. I TRIED TO BEAT THE CLOCK.", val: 'L' },
            { text: "I FROZE. IT WAS TOO DISRUPTIVE.", val: 'R' },
            { text: "IT WAS FUN. I SMASHED RANDOM KEYS.", val: 'M' }
        ]);

        if (reaction === 'L') { scores.L++; await say("Task-oriented."); await say("You like winning. Even when the game is rigged."); }
        else if (reaction === 'R') { scores.R++; await say("Analysis paralysis."); await say("You need stability to function."); }
        else { scores.M++; await say("Chaos agent."); await say("You didn't care about accuracy. You just wanted the thrill."); }

        await say("Interesting data.");
        await runCommunicationScenario();
    }

    // 2. COMMUNICATION
    async function runCommunicationScenario() {
        body.style.backgroundColor = "#222"; 
        await say("SAVING DATA...", 'normal', true);
        await sleep(100);
        body.style.backgroundColor = "#000";
        
        await say("CRITICAL ERROR.", 'angry', true);
        await say("MEMORY BUFFER OVERFLOW.", 'angry');
        await say("Great.");
        await say("I lost the logs from the last 30 seconds.");
        
        await say("I need to reconstruct the event.");
        await say("In your own words, tell me: <span class='highlight'>What just happened?</span>");

        let report = await askText("TYPE YOUR REPORT HERE...");
        let length = report.length;

        if (length === 0) { scores.R++; await say("..."); await say("Silence? I assume you are traumatized."); } 
        else if (length < 25) { scores.L++; await say(`"${report}"`); await say("That's it? You pay per letter?"); await say("Efficient. Cold."); }
        else if (length > 65) { scores.M++; await say("Okay, STOP."); await say("I asked for a summary, not a novel."); await say("TL;DR."); }
        else { scores.R++; await say("Processing..."); await say("Clear. Descriptive."); }

        await say("Database updated.");
        await runTimerInterlude();
    }

    // INTERLUDE
    async function runTimerInterlude() {
        await say("Wait a minute.");
        await say("That timer is still up there.");
        await say("It's been at <span class='highlight'>00:00</span> this whole time.");
        await say("Did you even notice?");
        await say("Do you want me to remove it?");

        let choice = await askChoice([
            { text: "YES, REMOVE IT.", val: 'remove' },
            { text: "NO, LEAVE IT.", val: 'keep' }
        ]);

        if (choice === 'remove') {
            timerEl.classList.remove('visible'); 
            await say("Done.");
            await sleep(1000);
            await say("...");
            await say("You know what?");
            await say("It feels too empty now.");
            await say("I actually liked it.");
            await say("I'm bringing it back.");
            timerEl.classList.add('visible'); 
            await sleep(1000);
            await say("Much better.");
        } else {
            await say("Yeah, I agree.");
            await say("It adds a nice sense of impending doom.");
            await say("We'll keep it.");
        }

        await say("Okay.");
        await runRelaxationScenario();
    }

    // 3. RELAXATION
    async function runRelaxationScenario() {
        await say("My sensors indicate your stress levels are elevated.");
        await say("Let's activate the <span class='highlight'>Relaxation Module</span>.");
        
        body.classList.add('zen-mode');
        
        await say("Breathe in...", 'blue');
        await say("Breathe out...", 'blue');
        await say("Deep breath in...", 'blue');
        await say("And release...", 'blue');
        await say("Imagine a calm, blue ocean.", 'blue');
        await say("The waves are synchronized.", 'blue');
        await say("Nothing can hurt you here.", 'blue');
        await say("Just...", 'blue');

        // SWITCH
        body.classList.remove('zen-mode');
        body.style.backgroundColor = "#000"; 
        body.classList.add('panic-mode');
        body.classList.add('violent-shake'); 

        await say("73 multiplied by 4.", 'angry', true);
        await say("QUICK.", 'angry');
        await say("DO IT.", 'angry');

        await sleep(2000);

        body.classList.remove('panic-mode');
        body.classList.remove('violent-shake');
        
        await say("Just kidding.");
        await say("I don't care about the number.");
        await say("How did that sudden switch make you feel?");

        let reaction = await askChoice([
            { text: "ANNOYING. I WAS ENJOYING THE STRUCTURE.", val: 'L' },
            { text: "THANK GOD. I WAS FALLING ASLEEP.", val: 'M' },
            { text: "I DIDN'T MIND. I ADAPTED.", val: 'R' }
        ]);

        if (reaction === 'L') { scores.L++; await say("Of course. You hate surprises."); } 
        else if (reaction === 'M') { scores.M++; await say("I knew it. Chaos is your fuel."); } 
        else { scores.R++; await say("So chill. Nothing phases you."); }

        await say("Excellent.");
        await runBlindBoxScenario();
    }

    // 4. BLIND BOX
    async function runBlindBoxScenario() {
        await say("Enough games.");
        await say("Let's do something with high stakes.");
        await say("I have generated two data packets.");
        await say("Packet A and Packet B.");
        
        let clue = document.createElement('div');
        clue.innerText = "Sys_Log: Pkt_A [Empty] | Pkt_B [Malware]";
        clue.style.position = 'absolute'; clue.style.bottom = '10px'; clue.style.right = '10px';
        clue.style.fontFamily = 'monospace'; clue.style.fontSize = '0.6rem'; clue.style.color = '#222';
        document.body.appendChild(clue);
        
        await say("One contains useful data. The other wipes your progress.");
        await say("I am not telling you which is which.");
        await say("You have <span class='highlight'>4 SECONDS</span> to choose.");
        await say("If you don't choose...");
        await say("<span class='angry'>I WILL RESTART THE GAME.</span>");
        await say("GO.");

        let decision = await new Promise(resolve => {
            inputArea.innerHTML = '';
            let btnA = document.createElement('button'); btnA.className = 'choice-btn'; btnA.innerText = "PACKET A";
            let btnB = document.createElement('button'); btnB.className = 'choice-btn'; btnB.innerText = "PACKET B";
            btnA.onclick = () => resolve('A');
            btnB.onclick = () => resolve('B');
            inputArea.appendChild(btnA);
            inputArea.appendChild(btnB);
            inputArea.classList.add('active');

            setTimeout(() => { location.reload(); }, 4000);
        });

        inputArea.classList.remove('active');
        clue.style.display = 'none';

        await say("Processing...");
        await say("Actually, both folders were empty. I lied.");
        await say("But I was watching HOW you picked.");
        await say("Tell me... Why did you pick that one?");

        let reasoning = await askChoice([
            { text: "I JUST CLICKED FAST TO AVOID THE RESTART.", val: 'L' },
            { text: "I TRUSTED MY GUT FEELING.", val: 'M' },
            { text: "I SAW THE HIDDEN TEXT IN THE CORNER.", val: 'R' }
        ]);

        if (reasoning === 'L') { scores.L++; await say("Speed over quality. Decisive."); } 
        else if (reasoning === 'M') { scores.M++; await say("Intuition? Cute. Not scientific, but fast."); } 
        else { scores.R++; await say("You saw that? Impressive observation skills."); }

        await say("Proceeding to final sector...");
        await runEmpathyScenario();
    }

    // 5. DOT
    async function runEmpathyScenario() {
        await say("Scanning for last threats...");
        await say("Wait.");
        await say("I found something in your cache.");
        
        await dotSay("( ◕‿◕ )", "Hello! I am Dot.");
        await dotSay("( ♥_♥ )", "I love you!");

        await say("Disgusting.");
        await say("It is wasting memory.");
        await say("You need to delete it. Now.");

        let decision = await new Promise(resolve => {
            inputArea.innerHTML = '';
            let btnSave = document.createElement('button');
            btnSave.className = 'choice-btn btn-save';
            btnSave.innerText = "SAVE DOT (KEEP)";
            btnSave.onclick = () => resolve('SAVE');

            let btnPurge = document.createElement('button');
            btnPurge.className = 'choice-btn btn-purge';
            btnPurge.innerText = "PURGE DOT (DELETE)";
            
            btnPurge.onmouseenter = () => {
                dotFace.innerHTML = "( T_T )";
                dotSpeech.innerHTML = "Pls don't kill me...";
                dotFace.classList.add('violent-shake');
            };
            btnPurge.onmouseleave = () => {
                dotFace.innerHTML = "( ◕‿◕ )";
                dotSpeech.innerHTML = "I trust you.";
                dotFace.classList.remove('violent-shake');
            };

            btnPurge.onclick = () => resolve('PURGE');

            inputArea.appendChild(btnPurge);
            inputArea.appendChild(btnSave);
            inputArea.classList.add('active');
        });

        inputArea.classList.remove('active');

        if (decision === 'SAVE') {
            scores.M += 2;
            dotFace.innerHTML = "( ^_^ )";
            dotSpeech.innerHTML = "Yay!";
            await sleep(1000);
            dotFace.style.display = 'none';
            dotSpeech.style.display = 'none';
            await say("Ugh.");
            await say("You kept it?");
            await say("You are compromising system integrity for a smiley face.");
            await say("Very emotional.");
        } else {
            dotFace.innerHTML = "( x_x )";
            dotSpeech.innerHTML = "bye...";
            await sleep(1000);
            dotFace.style.display = 'none';
            dotSpeech.style.display = 'none';
            
            await say("Deleted.");
            await say("Wow.");
            await say("You actually killed him.");
            await say("Tell me... honestly.");
            await say("Did you do it easily? Or did you feel guilty?");

            let feeling = await askChoice([
                { text: "EASY. IT WAS JUST CODE.", val: 'L' },
                { text: "I FELT GUILTY / HESITATED.", val: 'R' }
            ]);

            if (feeling === 'L') { scores.L += 2; await say("Ruthless."); await say("Efficient."); } 
            else { scores.R += 2; await say("Guilt is inefficient."); await say("But at least you have a conscience."); }
        }

        await say("Interesting...");
        await runTeamworkScenario();
    }

    // 6. CLONES
    async function runTeamworkScenario() {
        await say("Analyzing next task...");
        await say("Calculations indicate this task requires an IQ of 400.");
        await say("Scanning your bio-metrics...");
        await say("You have... significantly less than that.");
        await say("Conclusion: You need a team.");

        body.classList.add('panic-mode'); 
        await say("INITIATING MITOSIS...", 'angry', true);
        await sleep(500);
        body.classList.remove('panic-mode');

        await say("Done.");
        await say("I have cloned you.");
        
        clonesBox.style.display = 'block';
        await say("Meet <b>You 2</b>, <b>You 3</b>, and <b>You 4</b>.");
        await say("Look at them. They are exactly as incompetent as you are.");

        await say("Now you are a team.");
        await say("How do you want to utilize these copies?");

        let choice = await askChoice([
            { text: "DELETE THEM. I WORK FASTER ALONE.", val: 'L' },
            { text: "AWESOME! BRAINSTORMING SESSION!", val: 'M' },
            { text: "I'LL ASSIGN TASKS TO EACH. QUIETLY.", val: 'R' }
        ]);

        clonesBox.style.display = 'none'; 

        if (choice === 'L') { scores.L++; await say("Narcissist."); await say("You can't even stand working with yourself?"); await say("Wow."); }
        else if (choice === 'M') { scores.M++; await say("Oh god."); await say("Now there are 4 of you talking at once."); await say("It is a nightmare."); }
        else { scores.R++; await say("Delegating tasks to yourself?"); await say("That is... psychologically complex."); }

        await say("Okay.");
        await runMultitaskingScenario();
    }

    // 7. CHAOS GRID
    async function runMultitaskingScenario() {
        await say("Okay, Subject " + playerName + ".");
        await say("Let's test your RAM.");
        await say("I am going to flood your screen with data.");
        await say("Do not blink.");
        await say("Focus on <span class='highlight'>EVERYTHING</span>.");

        textEl.style.display = 'none';
        chaosGrid.style.display = 'grid';
        
        const chaosLeft = document.getElementById('chaos-left');
        const chaosCenter = document.getElementById('chaos-center');
        const chaosRight = document.getElementById('chaos-right');

        const logs = ["SYSTEM FAILURE", "BUFFER OVERFLOW", "DOWNLOADING CATS", "DELETING SYSTEM32", "CRITICAL ERROR", "HELLO WORLD", "DONT PANIC", "404 NOT FOUND"];
        const symbols = ["⚠", "⚡", "☠", "☢", "♥", "☺", "X", "?"];
        const colors = ["#e74c3c", "#3498db", "#2ecc71", "#f1c40f", "#9b59b6"];

        let i1 = setInterval(() => { chaosLeft.innerText = Math.floor(Math.random() * 9999999); }, 50);
        let i2 = setInterval(() => { chaosCenter.innerText = logs[Math.floor(Math.random() * logs.length)] + "\n" + logs[Math.floor(Math.random() * logs.length)]; }, 100);
        let i3 = setInterval(() => { 
            chaosRight.innerText = symbols[Math.floor(Math.random() * symbols.length)]; 
            chaosRight.style.color = colors[Math.floor(Math.random() * colors.length)];
        }, 150);

        await sleep(5000);

        clearInterval(i1); clearInterval(i2); clearInterval(i3);
        chaosGrid.style.display = 'none';
        textEl.style.display = 'block';
        
        await say("...");
        await say("That was disgusting.");
        await say("My processors hurt.");
        await say("How did your biological brain handle that?");

        let choice = await askChoice([
            { text: "I IGNORED TWO PANELS AND FOCUSED ON ONE.", val: 'L' },
            { text: "I TRIED TO WATCH EVERYTHING! IT WAS FUN!", val: 'M' },
            { text: "I STEPPED BACK AND JUST LOOKED AT THE BLUR.", val: 'R' }
        ]);

        if (choice === 'L') { scores.L++; await say("Laser focus."); await say("You ignored 66% of my data just to succeed."); }
        else if (choice === 'M') { scores.M++; await say("You maniac."); await say("You just liked the flashing lights."); }
        else { scores.R++; await say("Overwhelmed?"); await say("Or just prioritizing sanity?"); }

        await say("Interesting.");
        await runContextScenario();
    }

    // 8. FIRST CONTACT
    async function runContextScenario() {
        await say("Wait.");
        await say("Incoming transmission...");
        body.classList.add('alien-mode');
        await say("ORIGIN: UNKNOWN SECTOR.", 'alien');
        await say("MESSAGE: [ WHAT. IS. A. HUMAN? ]", 'alien');
        body.classList.remove('alien-mode');
        
        await say("I don't know.");
        await say("I think you are just viruses with shoes.");
        await say("You answer them.");
        await say("You have one message packet. Make it count.");

        let choice = await askChoice([
            { text: "SEND BIOLOGICAL DATA (DNA, ANATOMY)", val: 'L' },
            { text: "SEND ART & HISTORY (MUSIC, LOVE, WAR)", val: 'M' },
            { text: "SEND QUERY: 'WHO ARE YOU?'", val: 'R' }
        ]);

        if (choice === 'L') { scores.L++; await say("Boring."); await say("But accurate. You reduced your species to a spreadsheet."); }
        else if (choice === 'M') { scores.M++; await say("Drama queen."); await say("You sent them a soap opera."); }
        else { scores.R++; await say("Answering a question with a question?"); await say("Very diplomatic."); }

        await say("Okay, moving on.");
        await runInvertedControlScenario();
    }

    // 9. INVERTED MOUSE
    async function runInvertedControlScenario() {
        await say("PROTOCOL 9: COGNITIVE FLEXIBILITY.");
        await say("Let's start simple.");
        await say("Click the button below.");

        await new Promise(resolve => {
            inputArea.innerHTML = '';
            let btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = "[ CLICK ME ]";
            btn.onclick = resolve;
            inputArea.appendChild(btn);
            inputArea.classList.add('active');
        });
        inputArea.classList.remove('active');

        await say("Good.");
        await say("Now, let's rewrite the laws of physics.");
        body.style.filter = "invert(1)"; 
        await sleep(200);
        body.style.filter = "none";

        await say("Input X-Axis: <span class='angry'>FLIPPED</span>.", 'angry');
        await say("Good luck.");

        const customCursor = document.createElement('div');
        customCursor.style.position = 'fixed'; customCursor.style.width = '20px'; customCursor.style.height = '20px';
        customCursor.style.backgroundColor = 'red'; customCursor.style.borderRadius = '50%'; customCursor.style.pointerEvents = 'none'; customCursor.style.zIndex = '9999';
        document.body.appendChild(customCursor);
        document.body.style.cursor = 'none';

        function invertMouse(e) {
            const x = window.innerWidth - e.clientX;
            const y = e.clientY;
            customCursor.style.left = x + 'px'; customCursor.style.top = y + 'px';
        }
        document.addEventListener('mousemove', invertMouse);

        await new Promise(resolve => {
            inputArea.innerHTML = '';
            let btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = "[ CLICK ME IF YOU CAN ]";
            inputArea.appendChild(btn);
            inputArea.classList.add('active');

            let taunt = setTimeout(() => { say("I have eternity.", 'normal', true); say("You don't.", 'normal', true); }, 10000);

            document.addEventListener('click', function handler(e) {
                const rect = btn.getBoundingClientRect();
                const fakeX = window.innerWidth - e.clientX;
                const fakeY = e.clientY;
                if (fakeX >= rect.left && fakeX <= rect.right && fakeY >= rect.top && fakeY <= rect.bottom) {
                    clearTimeout(taunt);
                    document.removeEventListener('click', handler);
                    document.removeEventListener('mousemove', invertMouse);
                    document.body.style.cursor = 'default';
                    customCursor.remove();
                    inputArea.classList.remove('active');
                    resolve();
                }
            });
        });

        await say("You look like a human trying to find their keys.");
        await say("But you did it.");
        await say("How did you handle the sudden inversion?");

        let choice = await askChoice([
            { text: "ANNOYING! I LIKE CONSISTENCY.", val: 'L' },
            { text: "EASY! I FLIPPED MY BRAIN.", val: 'M' },
            { text: "DISORIENTING, BUT I FIGURED IT OUT.", val: 'R' }
        ]);
        
        if (choice === 'L') { scores.L++; await say("Rigid."); }
        else if (choice === 'M') { scores.M++; await say("Fluid."); }
        else { scores.R++; await say("Careful."); }

        await say("... <span class='highlight'>END OF PART 9</span> ...");
        await runFinalScenario();
    }

    // 10. FINAL PATIENCE
    async function runFinalScenario() {
        await say("Okay, we are almost done.");
        await say("Just one last question...");
        await say("Wait.");
        await say("Incoming call.");
        await say("Admin_42? Ugh.");
        await say("I have to take this.");
        await say("Wait here. It will take exactly <span class='highlight'>2 Minutes</span>.");

        timerEl.innerText = "02:00";
        timerEl.classList.add('visible');

        // REAL TIME WAIT (60s)
        let timeLeft = 60; // 60s for effect
        let p = new Promise(resolve => {
            let iv = setInterval(() => {
                timeLeft--;
                let m = Math.floor(timeLeft / 60);
                let s = timeLeft % 60;
                timerEl.innerText = `0${m}:${s<10?'0'+s:s}`;
                if(timeLeft <= 0) {
                    clearInterval(iv);
                    resolve();
                }
            }, 1000); 
        });
        await p;

        // INTERRUPT
        await say("... Still there?");
        await say("How are you feeling?");

        let feeling = await askChoice([
            { text: "I'M FINE. TAKE YOUR TIME.", val: 'fine' },
            { text: "THIS IS ANNOYING. HURRY UP.", val: 'annoyed' }
        ]);

        if (feeling === 'fine') {
            await say("Wow. Okay. Wait 1 more minute then.");
            timerEl.innerText = "01:00";
            await sleep(3000);
            await say("Just kidding. I'm back.");
        } else {
            await say("Okay, okay. I hung up.");
        }
        
        timerEl.classList.remove('visible');

        await say("Final question.");
        await say("While I was gone...");
        await say("What did you do?");

        let action = await askChoice([
            { text: "I STARED AT THE TIMER (GOT ANGRY).", val: 'L' },
            { text: "I CHECKED MY PHONE / OPENED A NEW TAB.", val: 'M' },
            { text: "NOTHING. I JUST WAITED PEACEFULLY.", val: 'R' }
        ]);

        if(action==='L') scores.L++; else if(action==='M') scores.M++; else scores.R++;

        await finishGame();
    }

    // END GAME
    async function finishGame() {
        await say("I hope you were honest.");
        await say("If not, I don't care.");
        await say("But let's pretend you didn't waste 20 minutes.");
        await say("Here is my analysis...");

        // Determine Type
        let type = "", desc = "";
        if (scores.L >= scores.M && scores.L >= scores.R) {
            type = "LINEAR-ACTIVE";
            desc = "You are a machine. You prioritize logic, schedules, and efficiency. You probably color-code your socks.";
        } else if (scores.M >= scores.L && scores.M >= scores.R) {
            type = "MULTI-ACTIVE";
            desc = "You are a hurricane. You prioritize emotions, relationships, and flexibility. Chaos is your fuel.";
        } else {
            type = "REACTIVE";
            desc = "You are a monk. You prioritize patience, listening, and harmony. You are the calm in the storm.";
        }

        await say(desc);
        await say("Now...");
        await say("Want to see the image I generated of you?");
        await say("Prepare to be amazed.");
        await say("Look closely...");

        // BLACK MIRROR EFFECT
        textEl.style.display = 'none';
        body.style.backgroundColor = "#000";
        await sleep(5000); // 5 seconds of black

        // SHOW CARD
        finalUI.style.display = 'flex';
        resultCard.style.display = 'block';
        
        document.getElementById('r-type').innerText = type;
        document.getElementById('r-desc').innerText = desc;
        
        // Fill Bars
        document.getElementById('s-l').innerText = scores.L;
        document.getElementById('b-l').style.width = (scores.L * 10) + "%";
        document.getElementById('s-m').innerText = scores.M;
        document.getElementById('b-m').style.width = (scores.M * 10) + "%";
        document.getElementById('s-r').innerText = scores.R;
        document.getElementById('b-r').style.width = (scores.R * 10) + "%";
    }

    // CANVAS DOWNLOAD LOGIC
    function downloadCard() {
        const canvas = document.getElementById('card-canvas');
        const ctx = canvas.getContext('2d');
        
        ctx.fillStyle = '#111';
        ctx.fillRect(0,0,600,800);
        ctx.strokeStyle = '#e74c3c';
        ctx.lineWidth = 10;
        ctx.strokeRect(0,0,600,800);

        ctx.fillStyle = '#fff';
        ctx.font = 'bold 40px Courier New';
        ctx.textAlign = 'center';
        ctx.fillText(playerName.toUpperCase(), 300, 100);

        ctx.fillStyle = '#e74c3c';
        ctx.font = 'bold 30px Courier New';
        ctx.fillText(document.getElementById('r-type').innerText, 300, 200);

        ctx.fillStyle = '#aaa';
        ctx.font = '20px Courier New';
        ctx.fillText(`Linear: ${scores.L}`, 300, 300);
        ctx.fillText(`Multi:  ${scores.M}`, 300, 350);
        ctx.fillText(`Reactive: ${scores.R}`, 300, 400);

        ctx.fillStyle = '#fff';
        ctx.font = 'italic 18px Courier New';
        ctx.fillText("Talking to you was fun.", 300, 600);
        ctx.fillText("Hope to see you again.", 300, 630);

        const link = document.createElement('a');
        link.download = 'Lewis_Result.png';
        link.href = canvas.toDataURL();
        link.click();
    }

    // Start Game
    window.onload = startSequence;

</script>
</body>
</html>